@model List<ResidentialHallManagement.Core.Entities.RoomApplicationRequest>

@{
    ViewData["Title"] = "Approve Room Applications";
    var hall = ViewBag.Hall as ResidentialHallManagement.Core.Entities.Hall;
}

<style>
    .applications-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 30px;
        border-radius: 20px;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
    }

    .application-card {
        border: none;
        border-radius: 20px;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .application-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .card-header-gradient {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        padding: 20px;
        border: none;
    }

    .student-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }

    .side-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .side-badge.window-side {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        color: #1565c0;
        border: 2px solid #42a5f5;
    }

    .side-badge.door-side {
        background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        color: #e65100;
        border: 2px solid #ff9800;
    }

    .info-row {
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .action-btn {
        border-radius: 12px;
        padding: 12px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 20px;
    }

    .empty-state i {
        font-size: 100px;
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 20px;
    }

    .stats-mini {
        display: flex;
        gap: 20px;
        margin-top: 15px;
    }

    .stats-mini-item {
        background: rgba(255, 255, 255, 0.15);
        padding: 10px 20px;
        border-radius: 10px;
    }

    .filter-section {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    @@keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    .pending-indicator {
        animation: pulse 2s infinite;
    }
</style>

<div class="container-fluid px-4 py-4">
    <!-- Header -->
    <div class="applications-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="mb-2"><i class="bi bi-file-earmark-check me-2"></i>Room Applications</h2>
                <p class="mb-0 opacity-75">Review and approve student room applications for @hall?.HallName</p>
                <div class="stats-mini">
                    <div class="stats-mini-item">
                        <i class="bi bi-hourglass-split"></i> <strong>@(Model?.Count ?? 0)</strong> Pending
                    </div>
                    <div class="stats-mini-item">
                        <i class="bi bi-building"></i> @hall?.HallName
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <a href="@Url.Action("Dashboard", "HallAdmin")" class="btn btn-light btn-lg">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show"
            style="border-radius: 12px; border-left: 4px solid #28a745;">
            <i class="bi bi-check-circle-fill me-2"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show"
            style="border-radius: 12px; border-left: 4px solid #dc3545;">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <!-- Filter Section -->
        <div class="filter-section">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="searchInput"
                            placeholder="Search by student ID or name...">
                    </div>
                </div>
                <div class="col-md-4">
                    <select class="form-select" id="sideFilter">
                        <option value="">All Preferred Sides</option>
                        <option value="Window">Window Side</option>
                        <option value="Door">Door Side</option>
                    </select>
                </div>
                <div class="col-md-4 text-end">
                    <span class="text-muted"><i class="bi bi-funnel"></i> Showing <strong
                            id="visibleCount">@Model.Count</strong> of @Model.Count applications</span>
                </div>
            </div>
        </div>

        <div class="row" id="applicationsGrid">
            @foreach (var app in Model.OrderByDescending(a => a.ApplicationDate))
            {
                <div class="col-md-6 col-lg-4 mb-4 application-item" data-student-id="@app.StudentId.ToLower()"
                    data-student-name="@(app.Student?.StudentName?.ToLower() ?? "")" data-side="@(app.PreferredSide ?? "")">
                    <div class="application-card card h-100">
                        <div class="card-header-gradient text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="student-avatar">
                                        <i class="bi bi-person-fill"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0">@app.StudentId</h5>
                                        <small class="opacity-75">@(app.Student?.StudentName ?? "Unknown")</small>
                                    </div>
                                </div>
                                <span class="badge bg-warning text-dark pending-indicator">
                                    <i class="bi bi-hourglass-split"></i> Pending
                                </span>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="info-row">
                                <span class="text-muted"><i class="bi bi-door-closed me-2"></i>Requested Room</span>
                                <span class="badge bg-secondary fs-6">@app.RequestedRoomIdentity</span>
                            </div>
                            <div class="info-row">
                                <span class="text-muted"><i class="bi bi-star me-2"></i>Preferred Side</span>
                                @if (app.PreferredSide == "Window")
                                {
                                    <span class="side-badge window-side">
                                        <i class="bi bi-sun"></i> Window Side
                                    </span>
                                }
                                else if (app.PreferredSide == "Door")
                                {
                                    <span class="side-badge door-side">
                                        <i class="bi bi-door-open"></i> Door Side
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-light text-muted">No Preference</span>
                                }
                            </div>
                            <div class="info-row">
                                <span class="text-muted"><i class="bi bi-mortarboard me-2"></i>Department</span>
                                <span>@(app.Student?.Department ?? "N/A")</span>
                            </div>
                            <div class="info-row">
                                <span class="text-muted"><i class="bi bi-calendar me-2"></i>Applied On</span>
                                <span>@app.ApplicationDate.ToString("dd MMM yyyy, HH:mm")</span>
                            </div>
                        </div>
                        <div class="card-footer bg-white border-0 p-4">
                            <div class="d-grid gap-2">
                                <button class="btn btn-success action-btn" data-bs-toggle="modal"
                                    data-bs-target="#approveModal_@app.ApplicationId">
                                    <i class="bi bi-check-circle me-2"></i> Approve Application
                                </button>
                                <button class="btn btn-outline-danger action-btn" data-bs-toggle="modal"
                                    data-bs-target="#rejectModal_@app.ApplicationId">
                                    <i class="bi bi-x-circle me-2"></i> Reject
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Approve Modal -->
                <div class="modal fade" id="approveModal_@app.ApplicationId" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 20px; overflow: hidden;">
                            <div class="modal-header text-white"
                                style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border: none;">
                                <h5 class="modal-title"><i class="bi bi-check-circle me-2"></i>Approve Application</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <form asp-action="ApproveApplication" asp-controller="HallAdmin" method="post">
                                <input type="hidden" name="applicationId" value="@app.ApplicationId" />
                                <div class="modal-body p-4">
                                    <div class="text-center mb-4">
                                        <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-success bg-opacity-10 mb-3"
                                            style="width: 80px; height: 80px;">
                                            <i class="bi bi-check-lg text-success" style="font-size: 40px;"></i>
                                        </div>
                                    </div>
                                    <p class="text-center mb-4">Are you sure you want to approve this application?</p>
                                    <div class="alert alert-info" style="border-radius: 12px;">
                                        <div class="d-flex align-items-center gap-3">
                                            <i class="bi bi-person-check" style="font-size: 24px;"></i>
                                            <div>
                                                <strong>@(app.Student?.StudentName ?? "Unknown")</strong> will be assigned
                                                to<br>
                                                <span class="badge bg-secondary mt-1">Room @app.RequestedRoomIdentity</span>
                                                @if (!string.IsNullOrEmpty(app.PreferredSide))
                                                {
                                                    <span
                                                        class="badge @(app.PreferredSide == "Window" ? "bg-info" : "bg-warning") mt-1">@app.PreferredSide
                                                        Side</span>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-light btn-lg" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-success btn-lg">
                                        <i class="bi bi-check-circle me-2"></i>Approve
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Reject Modal -->
                <div class="modal fade" id="rejectModal_@app.ApplicationId" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 20px; overflow: hidden;">
                            <div class="modal-header text-white"
                                style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border: none;">
                                <h5 class="modal-title"><i class="bi bi-x-circle me-2"></i>Reject Application</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <form asp-action="RejectApplication" asp-controller="HallAdmin" method="post">
                                <input type="hidden" name="applicationId" value="@app.ApplicationId" />
                                <div class="modal-body p-4">
                                    <div class="text-center mb-4">
                                        <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-danger bg-opacity-10 mb-3"
                                            style="width: 80px; height: 80px;">
                                            <i class="bi bi-x-lg text-danger" style="font-size: 40px;"></i>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Reason for Rejection <span
                                                class="text-danger">*</span></label>
                                        <textarea class="form-control" name="remarks" rows="4"
                                    placeholder="Please provide a clear reason for rejecting this application..."
                                    required style="border-radius: 12px;"></textarea>
                                        <small class="text-muted">This message will be visible to the student</small>
                                    </div>
                                </div>
                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-light btn-lg" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-danger btn-lg">
                                        <i class="bi bi-x-circle me-2"></i>Reject
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <i class="bi bi-check-circle-fill"></i>
            <h3 class="mt-3">All Applications Processed</h3>
            <p class="text-muted mb-4">There are no pending room applications at the moment.</p>
            <a href="@Url.Action("Dashboard", "HallAdmin")" class="btn btn-primary btn-lg">
                <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const sideFilter = document.getElementById('sideFilter');
            const applicationsGrid = document.getElementById('applicationsGrid');
            const visibleCount = document.getElementById('visibleCount');

            function filterApplications() {
                const searchTerm = searchInput?.value.toLowerCase() || '';
                const sideValue = sideFilter?.value || '';
                const items = document.querySelectorAll('.application-item');
                let count = 0;

                items.forEach(item => {
                    const studentId = item.dataset.studentId || '';
                    const studentName = item.dataset.studentName || '';
                    const side = item.dataset.side || '';

                    const matchesSearch = studentId.includes(searchTerm) || studentName.includes(searchTerm);
                    const matchesSide = !sideValue || side === sideValue;

                    if (matchesSearch && matchesSide) {
                        item.style.display = 'block';
                        count++;
                    } else {
                        item.style.display = 'none';
                    }
                });

                if (visibleCount) visibleCount.textContent = count;
            }

            searchInput?.addEventListener('input', filterApplications);
            sideFilter?.addEventListener('change', filterApplications);
        });
    </script>
}